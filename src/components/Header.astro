---
import Button from './ui/Button.astro';
import ThemeSwitcher from './ui/ThemeSwitcher';

const navLinks = [
  { label: 'Features', href: '#features' },
  { label: 'How It Works', href: '#how-it-works' },
  { label: 'Docs', href: '/docs/' },
  { label: 'GitHub', href: 'https://github.com/code-sensei/artemiskit', external: true },
];
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50"
>
  <div class="header-inner">
    <div class="container">
      <nav class="flex items-center justify-between h-16">
        <!-- Logo -->
        <a href="/" class="flex items-center gap-2.5 group">
          <img
            src="/artemiskit-logo.png"
            alt="ArtemisKit"
            class="h-7 w-auto transition-opacity duration-200 group-hover:opacity-80"
            height="28"
          />
        </a>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center gap-1">
          <!-- Nav Links -->
          <ul class="flex items-center">
            {navLinks.map((link) => (
              <li>
                <a
                  href={link.href}
                  class="nav-link"
                  {...(link.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
                >
                  <span>{link.label}</span>
                  {link.external && (
                    <svg class="w-3 h-3 opacity-50" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M7 17L17 7M17 7H7M17 7V17" />
                    </svg>
                  )}
                </a>
              </li>
            ))}
          </ul>

          {/* Divider */}
          <div class="w-px h-5 bg-zinc-800 mx-3" />

          {/* Actions */}
          <div class="flex items-center gap-2">
            <ThemeSwitcher client:load variant="compact" />
            <Button href="/docs/cli/getting-started/" variant="primary" size="sm">
              Get Started
            </Button>
          </div>
        </div>

        <!-- Mobile Menu Button -->
        <button
          id="mobile-menu-button"
          class="md:hidden flex items-center justify-center w-10 h-10 rounded-lg text-zinc-400 hover:text-zinc-100 hover:bg-zinc-800/50 transition-colors"
          aria-label="Toggle menu"
          aria-expanded="false"
        >
          <svg class="w-5 h-5 menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <line x1="4" y1="6" x2="20" y2="6" />
            <line x1="4" y1="12" x2="20" y2="12" />
            <line x1="4" y1="18" x2="20" y2="18" />
          </svg>
          <svg class="w-5 h-5 close-icon hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </nav>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="mobile-menu md:hidden hidden"
  >
    <div class="container py-4">
      <ul class="space-y-1">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class="mobile-nav-link"
              {...(link.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
            >
              <span>{link.label}</span>
              {link.external && (
                <svg class="w-4 h-4 opacity-40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M7 17L17 7M17 7H7M17 7V17" />
                </svg>
              )}
            </a>
          </li>
        ))}
      </ul>

      <div class="mt-4 pt-4 border-t border-zinc-800/50">
        <div class="flex items-center justify-between mb-4">
          <span class="text-sm text-zinc-500">Appearance</span>
          <ThemeSwitcher client:load />
        </div>

        <Button href="/docs/cli/getting-started/" variant="primary" class="w-full justify-center">
          Get Started
        </Button>
      </div>
    </div>
  </div>
</header>

<style>
  .header-inner {
    background: transparent;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  #header.scrolled .header-inner {
    background: rgba(9, 9, 11, 0.8);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(39, 39, 42, 0.5);
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 0.875rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: rgb(161, 161, 170);
    border-radius: 0.5rem;
    transition: color 0.2s, background-color 0.2s;
  }

  .nav-link:hover {
    color: rgb(244, 244, 245);
    background-color: rgba(39, 39, 42, 0.5);
  }

  .mobile-menu {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: rgba(9, 9, 11, 0.98);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(39, 39, 42, 0.5);
  }

  .mobile-nav-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.875rem 1rem;
    font-size: 0.9375rem;
    color: rgb(212, 212, 216);
    border-radius: 0.75rem;
    transition: all 0.2s;
  }

  .mobile-nav-link:hover {
    color: rgb(244, 244, 245);
    background-color: rgba(39, 39, 42, 0.4);
  }
</style>

<script>
  const header = document.getElementById('header');
  let ticking = false;

  const updateHeader = () => {
    const currentScroll = window.scrollY;
    if (currentScroll > 10) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
    ticking = false;
  };

  const handleScroll = () => {
    if (!ticking) {
      requestAnimationFrame(updateHeader);
      ticking = true;
    }
  };

  window.addEventListener('scroll', handleScroll, { passive: true });
  updateHeader();

  // Mobile menu toggle
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = mobileMenuButton?.querySelector('.menu-icon');
  const closeIcon = mobileMenuButton?.querySelector('.close-icon');

  mobileMenuButton?.addEventListener('click', () => {
    const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
    mobileMenuButton.setAttribute('aria-expanded', String(!isExpanded));
    mobileMenu?.classList.toggle('hidden');
    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');
  });

  // Close mobile menu on link click
  mobileMenu?.querySelectorAll('a').forEach((link) => {
    link.addEventListener('click', () => {
      mobileMenuButton?.setAttribute('aria-expanded', 'false');
      mobileMenu?.classList.add('hidden');
      menuIcon?.classList.remove('hidden');
      closeIcon?.classList.add('hidden');
    });
  });
</script>
